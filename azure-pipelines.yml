trigger:
  - main

pool:
  name: Default  # tu agente local: MacBook-Pro-de-Santos

stages:
  - stage: BuildAndTest
    displayName: "Build & Test"
    jobs:
      - job: Build
        steps:
          - checkout: self

          # === BACKEND ===
          - script: |
              echo "ðŸ”§ Compilando API .NET..."
              cd Marketplace.Api
              dotnet restore
              dotnet build --no-restore
              dotnet test --no-build --logger "trx;LogFileName=test_results.trx"
            displayName: "Build & Test Backend"

          # === FRONTEND ===
          - script: |
              echo "ðŸ§± Compilando frontend React..."
              cd ../marketplace.frontend
              npm install
              npm run build
            displayName: "Build Frontend"

          # === PUBLICACIÃ“N ===
          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: "$(System.DefaultWorkingDirectory)"
              artifactName: "marketplace-drop"

  - stage: DeployQA
    displayName: "Deploy QA"
    dependsOn: BuildAndTest
    jobs:
      - job: QA_Deploy
        steps:
          - script: echo "ðŸš€ Desplegando en QA (simulado)"
            displayName: "Deploy QA"

  - stage: DeployPROD
    displayName: "Deploy ProducciÃ³n"
    dependsOn: DeployQA
    jobs:
      - job: PROD_Deploy
        steps:
          - script: echo "ðŸš€ Desplegando en ProducciÃ³n (simulado)"
            displayName: "Deploy PROD"
